2023-11-06 12:30:40,625: ETL Pipeline: INFO: ETL process started
2023-11-06 12:30:40,708: ETL Pipeline: INFO: Running load_data_to staging
2023-11-06 12:30:40,889: ETL Pipeline: ERROR: ETL process encountered an error: 'DataFrame' object has no attribute 'map'
2023-11-06 12:32:56,180: ETL Pipeline: INFO: ETL process started
2023-11-06 12:32:56,244: ETL Pipeline: INFO: Running load_data_to staging
2023-11-06 12:32:56,415: ETL Pipeline: INFO: Loading data into tmp_glasses
2023-11-06 12:32:56,476: ETL Pipeline: INFO: Loading data into tmp_glasses completed
2023-11-06 12:33:00,922: ETL Pipeline: INFO: Loading data into tmp_cocktails
2023-11-06 12:33:00,955: ETL Pipeline: INFO: Loading data into tmp_cocktails completed
2023-11-06 12:33:00,978: ETL Pipeline: INFO: Loading data into tmp_stocks
2023-11-06 12:33:01,004: ETL Pipeline: INFO: Loading data into tmp_stocks completed
2023-11-06 12:33:01,735: ETL Pipeline: INFO: Loading data into tmp_transactions
2023-11-06 12:33:04,789: ETL Pipeline: INFO: Loading data into tmp_transactions completed
2023-11-06 12:33:06,436: ETL Pipeline: INFO: Loading data into dim_date
2023-11-06 12:33:09,232: ETL Pipeline: INFO: Loading data into dim_date completed
2023-11-06 12:33:09,242: ETL Pipeline: INFO: Updating report tables from staging
2023-11-06 12:33:09,242: ETL Pipeline: INFO: Loading data into 
MERGE INTO bars T
USING 
    (SELECT DISTINCT bar 
    FROM tmp_stocks) S
ON T.bar = S.bar
WHEN NOT MATCHED THEN
	INSERT (bar) 
    VALUES (S.bar);

2023-11-06 12:33:09,245: ETL Pipeline: INFO: Loading data into 
MERGE INTO bars T
USING 
    (SELECT DISTINCT bar 
    FROM tmp_stocks) S
ON T.bar = S.bar
WHEN NOT MATCHED THEN
	INSERT (bar) 
    VALUES (S.bar);
 completed
2023-11-06 12:33:09,245: ETL Pipeline: INFO: Loading data into 
MERGE INTO glasses T
USING tmp_glasses S
ON T.glass = S.glass
WHEN NOT MATCHED THEN 
	INSERT (glass) 
    VALUES (S.glass)

2023-11-06 12:33:09,247: ETL Pipeline: INFO: Loading data into 
MERGE INTO glasses T
USING tmp_glasses S
ON T.glass = S.glass
WHEN NOT MATCHED THEN 
	INSERT (glass) 
    VALUES (S.glass)
 completed
2023-11-06 12:33:09,247: ETL Pipeline: INFO: Loading data into 
MERGE INTO cocktails T
USING 
    (SELECT g.id AS glass_id , c.drink 
    FROM tmp_cocktails c
    LEFT JOIN glasses g
    ON c.glass=g.glass
    ) S
ON T.glass_id = S.glass_id AND T.drink = S.drink
WHEN NOT MATCHED THEN 
    INSERT (glass_id, drink) 
    VALUES (S.glass_id, S.drink)

2023-11-06 12:33:09,250: ETL Pipeline: INFO: Loading data into 
MERGE INTO cocktails T
USING 
    (SELECT g.id AS glass_id , c.drink 
    FROM tmp_cocktails c
    LEFT JOIN glasses g
    ON c.glass=g.glass
    ) S
ON T.glass_id = S.glass_id AND T.drink = S.drink
WHEN NOT MATCHED THEN 
    INSERT (glass_id, drink) 
    VALUES (S.glass_id, S.drink)
 completed
2023-11-06 12:33:09,251: ETL Pipeline: INFO: Loading data into 
MERGE INTO bar_stock T
USING 
    (SELECT b.id AS bar_id, g.id AS glass_id, stock 
    FROM tmp_stocks ts
    LEFT JOIN bars b
    ON ts.bar=b.bar
    LEFT JOIN glasses g
    ON ts.glass_type=g.glass
    ) S
ON T.bar_id = S.bar_id AND T.glass_id = S.glass_id
WHEN NOT MATCHED THEN 
    INSERT (bar_id, glass_id, stock) 
    VALUES (S.bar_id, S.glass_id, S.stock)

2023-11-06 12:33:09,254: ETL Pipeline: INFO: Loading data into 
MERGE INTO bar_stock T
USING 
    (SELECT b.id AS bar_id, g.id AS glass_id, stock 
    FROM tmp_stocks ts
    LEFT JOIN bars b
    ON ts.bar=b.bar
    LEFT JOIN glasses g
    ON ts.glass_type=g.glass
    ) S
ON T.bar_id = S.bar_id AND T.glass_id = S.glass_id
WHEN NOT MATCHED THEN 
    INSERT (bar_id, glass_id, stock) 
    VALUES (S.bar_id, S.glass_id, S.stock)
 completed
2023-11-06 12:33:09,254: ETL Pipeline: INFO: Loading data into 
MERGE INTO fact_transactions H
USING (
    SELECT b.id AS bar_id, c.id AS cocktail_id, amount, tx.time
    FROM tmp_transactions tx
    INNER JOIN bars b ON tx.location=b.bar
    INNER JOIN cocktails c ON tx.drink=c.drink
    ) S
ON H.bar_id = S.bar_id AND H.cocktail_id = S.cocktail_id AND H.date = S.time
WHEN NOT MATCHED THEN 
    INSERT (bar_id, cocktail_id, amount, date) 
    VALUES (S.bar_id, S.cocktail_id, S.amount, S.time)

2023-11-06 12:33:09,507: ETL Pipeline: INFO: Loading data into 
MERGE INTO fact_transactions H
USING (
    SELECT b.id AS bar_id, c.id AS cocktail_id, amount, tx.time
    FROM tmp_transactions tx
    INNER JOIN bars b ON tx.location=b.bar
    INNER JOIN cocktails c ON tx.drink=c.drink
    ) S
ON H.bar_id = S.bar_id AND H.cocktail_id = S.cocktail_id AND H.date = S.time
WHEN NOT MATCHED THEN 
    INSERT (bar_id, cocktail_id, amount, date) 
    VALUES (S.bar_id, S.cocktail_id, S.amount, S.time)
 completed
2023-11-06 12:33:09,507: ETL Pipeline: INFO: Report tables update completed
2023-11-06 12:33:09,507: ETL Pipeline: INFO: ETL process completed
